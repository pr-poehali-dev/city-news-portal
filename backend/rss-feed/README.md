# RSS-ленты для Город говорит: Краснодар

Этот backend-функция генерирует две RSS-ленты для разных платформ.

## Доступные ленты

### 1. RSS для Яндекс.Новости
**URL**: `https://functions.poehali.dev/ca2cee13-dce4-42ea-8fb9-2b5c115b07dc?feed_type=news`

Стандартная RSS-лента для агрегаторов новостей с базовой информацией:
- Заголовок
- Описание
- Категория
- Изображение
- Ссылка на материал

### 2. RSS для Яндекс.Дзен
**URL**: `https://functions.poehali.dev/ca2cee13-dce4-42ea-8fb9-2b5c115b07dc?feed_type=dzen`

Расширенная RSS-лента с поддержкой форматирования для Яндекс.Дзен:
- Полный текст статьи в `<content:encoded>`
- Форматирование (заголовки, списки, жирный, курсив)
- Изображения внутри контента
- Категории публикации (format-article, index, comment-all)
- Уникальный GUID для предотвращения дубликатов

## Особенности Дзен-ленты

### Категории публикации
- `format-article` — материал публикуется как статья
- `index` — материал индексируется в поисковых системах
- `comment-all` — комментировать могут все пользователи

### Форматирование контента
Поддерживаются следующие элементы:
- `<h2>, <h3>, <h4>` — заголовки
- `<p>` — абзацы
- `<b>` — жирный текст
- `<i>` — курсив
- `<figure><img>` — изображения
- `<a>` — ссылки

### GUID
Для каждого материала генерируется уникальный MD5-хеш на основе URL. Это позволяет:
- Избежать дубликатов при повторной отправке
- Обновлять уже опубликованные материалы

## Использование

### В Яндекс.Новостях
1. Добавьте URL с параметром `?feed_type=news`
2. Дождитесь индексации (обычно 1-2 часа)

### В Яндекс.Дзен
1. Перейдите в настройки канала
2. Добавьте RSS-ленту с URL `?feed_type=dzen`
3. Выберите режим публикации (автоматический или черновики)

## Технические детали

- **Лимит**: 50 последних новостей
- **Кодировка**: UTF-8
- **Формат дат**: RFC822
- **Кеширование**: 5 минут (300 секунд)
- **CORS**: Разрешены запросы с любых доменов

## База данных

Функция читает данные из таблицы `news`:
```sql
SELECT id, title, excerpt, content, category, image_url, 
       published_at, updated_at, tags, is_svo, is_showbiz
FROM news 
WHERE status = 'published' 
ORDER BY published_at DESC 
LIMIT 50
```

## Примеры использования

### Просмотр ленты в браузере
```
https://functions.poehali.dev/ca2cee13-dce4-42ea-8fb9-2b5c115b07dc?feed_type=dzen
```

### Подключение к RSS-читалке
Скопируйте URL и добавьте в любой RSS-агрегатор (Feedly, Inoreader и т.д.)

### Тестирование
```bash
curl "https://functions.poehali.dev/ca2cee13-dce4-42ea-8fb9-2b5c115b07dc?feed_type=dzen"
```
